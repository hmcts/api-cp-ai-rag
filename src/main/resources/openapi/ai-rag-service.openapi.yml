openapi: 3.0.0
servers:
  - description: APIHub API Auto Mocking AI RAG service APIs
    url: https://virtserver.swaggerhub.com/HMCTS-DTS/api-cp-ai-rag/0.0.0
info:
  title: RAG Service API
  version: 0.0.0
  description: API for RAG service for document ingestion and answer retrieval
  contact:
    email: no-reply@hmcts.com
  license:
    name: MIT
    url: 'https://opensource.org/licenses/MIT'
components:
  schemas:
    uuid:
      type: string
      pattern: ^[a-fA-F0-9]{8}-[a-fA-F0-9]{4}-[a-fA-F0-9]{4}-[a-fA-F0-9]{4}-[a-fA-F0-9]{12}$
    metadataFilter:
      description: 'A key value pair object representing a filter value to be applied to the metadata of the ingested documents'
      type: object
      properties:
        key:
          type: string
          description: Key attribute represenatation
          maxLength: 1024
        value:
          type: string
          description: Value field representation
      required:
        - key
        - value

    documentIngestionStatusReturnedSuccessfully:
      description: 'Payload representing the response for successful document ingestion status retrieval'
      type: object
      properties:
        documentName:
          type: string
          description: Name of the document
          maxLength: 1024
        documentId:
          $ref: '#/components/schemas/uuid'
        status:
          type: string
          description: Status of the document ingestion
          enum:
            - INGESTION_SUCCESS
            - INGESTION_FAILED
            - METADATA_VALIDATED
            - INVALID_METADATA
        lastUpdated:
          type: string
          format: date-time
          description: Timestamp of the last update
        reason:
          type: string
          description: Reason for the current status, if applicable
    documentStatusNotAvailable:
      description: 'Payload representing the response when document not known to the service'
      type: object
      properties:
        documentName:
          type: string
          description: Name of the document
          maxLength: 1024
        reason:
          type: string
          description: Reason for the current status, if applicable
    userQueryAnswerReturnedSuccessfully:
      description: 'Payload representing the response for successful answer generation to user query'
      type: object
      properties:
        userQuery:
          type: string
          description: Query sent by the user
        llmResponse:
          type: string
          description: Response generated by the LLM
        queryPrompt:
          type: string
          description: Prompt used for querying the LLM
        chunkedEntries:
          type: array
          description: List of chunked entries used to generate the answer
          items:
            type: object

paths:
  /rag-service/document-status:
    get:
      summary: Get document status
      parameters:
        - name: document-name
          in: query
          required: true
          schema:
            type: string
            maxLength: 1024
          description: Name of the document to retrieve status for
      responses:
        '200':
          description: Document ingestion status retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/documentIngestionStatusReturnedSuccessfully'
        '404':
          description: Document not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/documentStatusNotAvailable'

  /rag-service/answer-user-query:
    post:
      summary: Answer user query
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                userQuery:
                  type: string
                queryPrompt:
                  type: string
                metadataFilters:
                  type: array
                  items:
                    $ref: '#/components/schemas/metadataFilter'
              required:
                - userQuery
                - queryPrompt
                - metadataFilters
      responses:
        '200':
          description: Answer returned successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/userQueryAnswerReturnedSuccessfully'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                type: object
                properties:
                  errorMessage:
                    type: string
                    description: Error message detailing the issue
